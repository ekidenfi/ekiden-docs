---
0: "A"
1: "l"
2: "l"
3: " "
4: "d"
5: "e"
6: "p"
7: "o"
8: "s"
9: "i"
10: "t"
11: "s"
12: " "
13: "a"
14: "n"
15: "d"
16: " "
17: "w"
18: "i"
19: "t"
20: "h"
21: "d"
22: "r"
23: "a"
24: "w"
25: "a"
26: "l"
27: "s"
28: " "
29: "w"
30: "i"
31: "l"
32: "l"
33: " "
34: "b"
35: "e"
36: " "
37: "h"
38: "a"
39: "n"
40: "d"
41: "l"
42: "e"
43: "d"
44: " "
45: "v"
46: "i"
47: "a"
48: " "
49: "t"
50: "h"
51: "e"
52: " "
53: "S"
54: "D"
55: "K"
56: ","
57: " "
58: "w"
59: "h"
60: "i"
61: "c"
62: "h"
63: " "
64: "w"
65: "i"
66: "l"
67: "l"
68: " "
69: "b"
70: "e"
71: " "
72: "a"
73: "v"
74: "a"
75: "i"
76: "l"
77: "a"
78: "b"
79: "l"
80: "e"
81: " "
82: "s"
83: "h"
84: "o"
85: "r"
86: "t"
87: "l"
88: "y"
title: "Deposit & Withdraw Funds"
---

## Overview

Ekiden uses a smart contract-based margin bank to custody collateral for trading. Users can deposit USDC to the margin bank and withdraw available (free) collateral at any time. All deposits and withdrawals are on-chain but occur on Aptos. 

## Supported Tokens

Ekiden supports the following tokens as margin collateral:

- USDC.
- More coming soon. 

Check the /tokens endpoint or documentation for the most current list.

## Depositing Tokens

### Steps

- Ensure Wallet Connection to the correct network
- Call Deposit Endpoint or SDK Method

### REST

**Get Deposits**

```ts
GET /api/v1/deposits
```

**Get Withdrawals**

```typescript
GET /api/v1/withdraws
```

### SDK Examples

**Deposit**

```typescript
import {
  Aptos,
  AptosConfig,
  Ed25519Account,
  Ed25519PrivateKey,
  Network,
} from "@aptos-labs/ts-sdk";

import "dotenv/config";

import { EkidenClient, TESTNET } from "../dist/index.js";

const TESTNET_USDC =
  "0x9967e130f7419f791c240acc17dde966ec84ad41652e2e87083ee613f460d019";

const TESTNET_VAULT_ADDRESS =
  "0x9e53ba9771421bddb0ba8722cde10b8c6a933dba8557075610698a95b8a82ec6";

const config = {
  privateKey: process.env["PK"], // Replace with your private key
  vaultAddress: TESTNET_VAULT_ADDRESS,
  assetMetadata: TESTNET_USDC,
  amount: BigInt(1000000), // 1 USDC (1e6)
};

async function depositExample() {
  const ekiden = new EkidenClient({
    baseURL: TESTNET.baseURL,
  });
  const aptosConfig = new AptosConfig({ network: Network.TESTNET });
  const aptos = new Aptos(aptosConfig);

  const privateKey = new Ed25519PrivateKey(config.privateKey);
  const account = new Ed25519Account({ privateKey });

  console.log(1, account.accountAddress.toString());

  const bal = await aptos.getAccountAPTAmount({
    accountAddress: account.accountAddress.toString(),
  });
  console.log("APT (octas):", bal, "≈ APT:", Number(bal) / 1e8);

  const transactionPayload = ekiden.vault.depositIntoUser({
    vaultAddress: config.vaultAddress,
    assetMetadata: config.assetMetadata,
    amount: config.amount,
  });

  const { gas_estimate } = await aptos.getGasPriceEstimation();

  const draft = await aptos.transaction.build.simple({
    sender: account.accountAddress,
    data: transactionPayload,
    options: { gasUnitPrice: gas_estimate },
  });

  const [sim] = await aptos.transaction.simulate.simple({
    signerPublicKey: account.publicKey,
    transaction: draft,
  });

  const gasUsed = BigInt(sim.gas_used ?? 20000);
  const maxGasAmount = gasUsed + 5000n;

  const tx = await aptos.transaction.build.simple({
    sender: account.accountAddress,
    data: transactionPayload,
    options: {
      gasUnitPrice: gas_estimate,
      maxGasAmount, // bigint!
    },
  });

  const auth = aptos.transaction.sign({ signer: account, transaction: tx });
  const submitted = await aptos.transaction.submit.simple({
    transaction: tx,
    senderAuthenticator: auth,
  });
  await aptos.waitForTransaction({ transactionHash: submitted.hash });

  console.log(`Deposit transaction submitted: ${submitted.hash}`);
}

depositExample();
```

**Withdraw**

```typescript
import {
  Aptos,
  AptosConfig,
  Ed25519Account,
  Ed25519PrivateKey,
  Network,
} from "@aptos-labs/ts-sdk";

import "dotenv/config";

import { EkidenClient, TESTNET } from "../dist/index.js";

const TESTNET_USDC =
  "0x9967e130f7419f791c240acc17dde966ec84ad41652e2e87083ee613f460d019";

const TESTNET_VAULT_ADDRESS =
  "0x9e53ba9771421bddb0ba8722cde10b8c6a933dba8557075610698a95b8a82ec6";

const config = {
  privateKey: process.env["PK"], // Replace with your private key
  vaultAddress: TESTNET_VAULT_ADDRESS,
  assetMetadata: TESTNET_USDC,
  amount: BigInt(1000000), // 1 USDC (1e6)
};

async function depositExample() {
  const ekiden = new EkidenClient({
    baseURL: TESTNET.baseURL,
  });
  const aptosConfig = new AptosConfig({ network: Network.TESTNET });
  const aptos = new Aptos(aptosConfig);

  const privateKey = new Ed25519PrivateKey(config.privateKey);
  const account = new Ed25519Account({ privateKey });

  console.log(1, account.accountAddress.toString());

  const bal = await aptos.getAccountAPTAmount({
    accountAddress: account.accountAddress.toString(),
  });
  console.log("APT (octas):", bal, "≈ APT:", Number(bal) / 1e8);

  const transactionPayload = ekiden.vault.depositIntoUser({
    vaultAddress: config.vaultAddress,
    assetMetadata: config.assetMetadata,
    amount: config.amount,
  });

  const { gas_estimate } = await aptos.getGasPriceEstimation();

  const draft = await aptos.transaction.build.simple({
    sender: account.accountAddress,
    data: transactionPayload,
    options: { gasUnitPrice: gas_estimate },
  });

  const [sim] = await aptos.transaction.simulate.simple({
    signerPublicKey: account.publicKey,
    transaction: draft,
  });

  const gasUsed = BigInt(sim.gas_used ?? 20000);
  const maxGasAmount = gasUsed + 5000n;

  const tx = await aptos.transaction.build.simple({
    sender: account.accountAddress,
    data: transactionPayload,
    options: {
      gasUnitPrice: gas_estimate,
      maxGasAmount, // bigint!
    },
  });

  const auth = aptos.transaction.sign({ signer: account, transaction: tx });
  const submitted = await aptos.transaction.submit.simple({
    transaction: tx,
    senderAuthenticator: auth,
  });
  await aptos.waitForTransaction({ transactionHash: submitted.hash });

  console.log(`Deposit transaction submitted: ${submitted.hash}`);
}

depositExample();
```